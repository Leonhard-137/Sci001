2025-11-30：
# 1.计算思路梳理：
现在要开始正式计算$H_0$，首先梳理一下计算思路。第一步是计算距离$D_L$，计算的出发点依旧是Cackett在2007年提出的改进公式：
$$
	\frac{D}{6.3Mpc} = \left(\frac{\tau}{day} \right)\left(\frac{\lambda}{10^4 \dot{A}}\right)^{-3/2}\left(\frac{f_\nu^B/\cos{i}}{Jy}\right)^{-1/2}\left(\frac{1-\varepsilon}{1-\varepsilon^{3/2}}\right)^{2}
$$
其中，
- D表示AGN的距离，光度距离
- $\tau$是时间延迟以天做单位
- $f_v^{B}$是指亮台AGN的辐射流量（光变曲线最大值），以Jy为单位
- $i$是吸积盘的倾斜角
- $\varepsilon$是比例系数$f_\nu^{F}/f_{\nu}^{B}$，暗态AGN辐射流量与亮态的比

我手上目前得到的数据有，$\tau$、$\lambda$、$f_\nu^{B} \& f_\nu^{F}$，进一步需要计算比例系数$\varepsilon$而后转化辐射流量的单位，最后每个波段都能计算出距离$D。

第二步是计算哈勃常数，这一步需要结合FRW度规下的宇宙光度距离计算公式（基于红移$z$的测量）：
$$
	D_{L} = \frac{c}{H_0}(1+z)|\Omega_z|^{-1/2}S_k\left[|\Omega_k|^{1/2}\times \int_z^{1+z}\frac{dx}{(\Omega_Mx^3 +\Omega_\Lambda +\Omega_k x^2)}\right]
$$
这里，
- $x = 1+z$
- $\Omega_M$ = 0.3，$\Omega_\Lambda = 0.7$，$\Omega_k = 1-\Omega_M-\Omega_\lambda = 0$
- $$
	S_k = 
\begin{cases}
sinh ，& for~\Omega_k >0\\
sin， & for~\Omega_k<0 \\
|\Omega_k|^{-1/2}, & for~\Omega_k =0
\end{cases}
$$
上面两个公式的具体解析在我的本科毕业论文中有详细说明。
使用距离的计算公式可以对多波段同时进行拟合并计算得到哈勃常数$H_0$。计算步骤总结为：
1. 计算光度距离$D_L$：
	1. 更改$Pyroa$中$Utils$的代码，直接计算输出$\varepsilon$。
	2. 新建流量单位转换函数（只针对Mkr142，别的AGN后续优化）
	3. 根据光度距离计算公式计算光度距离。
	4. 对光度距离的结果做后分析，并回溯处理前面的步骤。
2. 计算哈勃常数$H_0$：
	1. 多波段数据蒙特卡洛马尔科夫链拟合哈勃常数$H_0$
	2. 绘制角图收敛图等分析结果可靠性
	3. 讨论结果并做进一步分析，包括使用多AGN源的数据

# 2.光度距离计算：
1. 计算输出$\varepsilon$
这部分主要的思路是从$uncertainties$库里面引用$ufloat$函数，这个函数定义了带误差的量，
$$
	u = ufloat(u\_nominal\_{val}, u\_std\_dev)
$$
这样的量可以直接做运算，结果采用$u.nominal\_value$和$u.std\_dev$可以提取期望值和误差偏离。另外需要主义的就是，这个函数不能作用在数组上，我开始直接将其作用在数组上报错了。解决方式是使用zip函数，这个函数作用在多个可迭代对象上（列表，字符串）将其合成，比如：
```
	a &= [1, 2, 3] 
	b &= ['a', 'b', 'c'] 
	list(zip(a, b)) &= [(1, 'a'),(2, 'b'),(3, 'c')]
```
这样，我就可以通过列表表达式来使用$ufloat$了，
```
	unred_agn_b = [ufloat(b, e) for b, e in zip(d('unred_agn_b'), d('unred_agn_b_err'))]
	unred_agn_f = [ufloat(b, e) for b, e in zip(d('unred_agn_f'), d('unred_agn_f_err'))]
	epsilon = [f/b for f, b in zip(unred_agn_f, unred_agn_b)]
	
	epsilon_nominal = [e.nominal_value for e in epsilon]
	epsilon_dev = [e.std_dev for e in epsilon]
```
学习了zip函数和列表表达式的使用。
下面分析结果，之前与老师讨论他认为$\varepsilon$应该是一个不随波长变化的值，但是这不对。分析一下原因，简化模型中光变曲线由以下公式分解：
$$
	f_\lambda(t) = A_\lambda  + R_\lambda X(t)
$$
那么$f_\lambda^{F} = A_\lambda +R_\lambda X^{min}$，$f_\lambda^{B} = A_\lambda +R_\lambda X^{max}$
其商
$$
	\varepsilon = \frac{A_\lambda +R_\lambda X^{min}}{A_\lambda +R_\lambda X^{max}}
$$
显然是波长相关的。
写着发现自己犯了一个错误，原公式$\varepsilon$是频率密度的商，而我这里是波长密度的商，让我检查一下这里有没有影响。对单位能量间隔，有两种表达
$$
	f_\lambda d\lambda = -f_\nu d\nu
$$
这里符号是源自波长和频率的相反变化关系，于是可以得到：
$$
	f_{\lambda} = -f_\nu \frac{d \nu}{d \lambda} = -f_{\nu}\frac{dc/\lambda}{\lambda} = \frac{c}{\lambda^2}f_{\nu}
$$
对于同波长辐射流量密度，转换因子相同，所以相除抵消，结果不变。
给定单位：$10^{-15} \, \text{erg/s/cm}^2/Å$，目标是将其转换为 **Jy**。
2. 转换因子计算
已知：
- $1 \, \text{erg/s/cm}^2/\text{Hz} = 10^{23} \, \text{Jy}$
- 波长和频率的关系：$f_{\nu} = f_{\lambda} \times \frac{\lambda^2}{c}$
  - 其中，$f_{\nu}$ 是频率密度（单位：erg/s/cm²/Hz），$f_{\lambda}$ 是波长密度（单位：erg/s/cm²/Å），$c = 2.99792458 \times 10^{18} \, \text{Å/s}$ 是光速。
现在手上有数据（这里的c和$\lambda$只是数，转换时$c = 10^{18} \text{Å/s}$，其单位放进流量密度转化，只取$10^{18}$)：
$$
	1 \times \, erg/s/cm^2/Å = 1\times\frac{\lambda^2}{c} \, erg/s/cm^2/Hz = 1\times\frac{\lambda^2}{c}  \times10^{23} \, \text{Jy}
$$
所以我要的单位与$Jy$的转化是：
$$
		1 \times10^{-15} \, erg/s/cm^2/Å = 1\times\frac{\lambda^2}{c} \, 10^{-15}erg/s/cm^2/Hz = 1\times\frac{\lambda^2}{c}  \times10^{8} \, \text{Jy}
$$
我手上数据是$f_\lambda \times10^{-15} \, erg/s/cm^2/Å$，对应了：
$$
f_\lambda\times\frac{\lambda^2}{c}  \times10^{8} \, \text{Jy}
$$
这样最终转换只是我的数据乘以以下因子：
$$
\boxed{\frac{\lambda^2}{c} \times 10^{8}}
$$


其中，$c = 2.99792458 \times 10^{18}$，$\lambda$ 为波长（单位：Å）。这套单位转化看着简单，但是我磕磕碰碰知道今天才理顺，就是因为没有分清楚带单位的物理量和其对应的数之间的关系，虽然从结果上看，我之前写的单位转化公式是对的，但是那个更多是处于一个反向的调整
3. 光度距离计算
第一批光度距离计算结果得到了，

| 波长   | 距离  |
| ---- | --- |
| 1928 | 387 |
| 2236 | 191 |
| 2600 | 381 |
| 3467 | 588 |
| 4392 | 418 |
| 4770 | 323 |
| 5468 | 423 |
| 6215 | 431 |
| 7545 | 343 |
| 8700 | 306 |
当然我并不满意这个结果，弥散很大，大多计算结果在$300$到$450$这个很宽的区间内，波长为2236和3467的结果极为离群。所以此时我觉得我需要回溯进行问题排查了，第一是直接计算每个距离对应的哈勃常数，看看宽区间的影响有多大；第二是检查之间过程的计算结果，主要就是$\tau$和$f_\nu^{B}$这两个结果会有异常。
按照我的想法，就算有核内消光的影响，但是我的SED分析结果和时间延迟分析结果如果不偏离很大的话，就算有那个未知的整体偏低之谜，也不应该有很大的弥散。
****
# 距离计算结果回溯分析（第一次）
## 1.计算基本情况：
对象：Mrk142
目的：利用已知的辐射流量和时间延迟计算Mrk142的距离，并反过来利用FRW度规下的光度距离计算公式得到哈勃常数。
方法：目前利用已知的结果，让辐射流量乘以转换因子，代入其他值，得到距离的计算结果，并针对每个距离的分别计算了哈勃常数。
初步结果分析：由于那个未解的“整体距离偏低”的问题，这时我就不在关注结果是否能接近主流的哈勃常数了，而是关注计算结果的弥散。在我看来，如果数据都能很好的符合幂律关系的话，以此为基光度距离计算结果应该在一个中心值附近波动，整体的偏离应该来自于幂律关系的放大项。所以我想先确定这个是否计算结果真的只是整体偏低，在某中心值附近波动没有离群值。
## 2. 计算结果分析
已知值的弥散影响：
计算公式：
$$
	\frac{D_L}{6.3Mpc} = \left(\frac{\tau}{day} \right)\left(\frac{\lambda}{10^4 \dot{A}}\right)^{-3/2}\left(\frac{f_\nu^B/\cos{i}}{Jy}\right)^{-1/2}\left(\frac{1-\varepsilon}{1-\varepsilon^{3/2}}\right)^{2}
$$
$$
H_0 = \frac{c \cdot \int_1^{1+z} \frac{dx}{(0.3 x^3 + 0.7)^{1/2}}}{D_L (1 + z)}
$$
SED计算结果：
![[Mrk142_powerlaw_fit.pdf]]
可以看见第3、8个显然偏低，而第4、7个显然偏高。

时间延迟计算结果：
![[Mrk142_lambda_tau_fit.png]]

可以看见第2个显著偏低，而第4、7个显然偏高。

| 波长   | 距离  |
| ---- | --- |
| 1928 | 387 |
| 2236 | 191 |
| 2600 | 381 |
| 3467 | 588 |
| 4392 | 418 |
| 4770 | 323 |
| 5468 | 423 |
| 6215 | 431 |
| 7545 | 343 |
| 8700 | 306 |
目前直觉上确实可以认为距离的计算弥散主要源自单个波段并不清楚的对标准powerlaw的偏离，哈勃常数应该在30~45这个区间，与cackett的结果偏离不大（粗略的看）
## 2. 结论
结果的异常弥散源自原始数据对幂律的偏离，如果没有此偏离，结果应该会集中在某一中心值附近（待做：可以取标准值验证）

---
# 3.哈勃常数计算：
现在开始正式采取MCMC的方式对结果进行计算，结果是：
![[corner_plot.png]]
其实我觉得还可以，因为结果和cackett结果相近，模型偏离参数并不是很离谱。好吧我觉得今天的科研就做到这，整体来说今天还是有不少新的进展和思考的。首先修正了单位转化因子，这为后面更加普适的单位转化方程打下了基础。而后进行了距离计算，检查了结果的弥散情况和原始计算数据是否相匹配，进一步把弥散问题落在观测数据对已知powerlaw模型的偏离。最后用mcmc计算了哈勃常数，这个结果还算在我的预料之中。接下来，除了进一步把这套工作流程适配到其他数据源上，我还想做一个MCMC的专题学习，找些资料好好学习整理一下，还要发知乎，当然这是100分的要求。60分的要求就是搞清楚后处理怎么反应拟合效果就行了。